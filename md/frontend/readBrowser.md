# 浏览器
> 浏览器的主要功能是展示网页资源，也即请求服务器并将结果显示在浏览器窗口中。资源的格式一般是 HTML，但也有 PDF、图片等其它各种格式。资源的定位由 URI(Uniform resource Identifier) 来实现。

## 浏览器的结构
![alt text](/md/imgs/browser.png)
1. 用户接口（User Interface）包括地址栏，前进后退，书签菜单等窗口上除了网页显示区域以外的部分。
2. 浏览器引擎（Browser engine）：查询与操作渲染引擎的接口。
3. 渲染引擎（Rendering engine）。负责显示请求的内容，比如请求到HTML, 它会负责解析HTML与CSS并将结果显示到窗口中。
4. 网络（Networking）。用于网络请求, 如 HTTP 请求。它包括平台无关的接口和各平台独立的实现。
5. UI 后端（UI backend）。绘制基础元件，如组合框与窗口。它提供平台无关的接口，内部使用操作系统的相应实现。
6. JavaScript解释器（JavaScript Interpreter）：用于解析执行JavaScript代码。
7. 数据存储（Data storage）。这是一个持久层。浏览器需要把所有数据存到硬盘上，如 cookies。新的HTML规范 (HTML5) 规定了一个完整（虽然轻量级）的浏览器中的数据库：web database。

## 页面请求
当我们按下 enter 键之后，浏览器就会发起一个 HTTP 请求，我们也可以从控制台看到：所有浏览器发起的网络请求，包括页面、图片、CSS 文件、xhr 请求等等，还能看到请求的状态（200成功、404找不到、缓存、重定向等等）、耗时、请求头和内容、返回头和内容，等等等等。
### 一个完整的 HTTP 请求过程
- 域名解析（此处涉及DNS的寻址过程）
- 发起TCP的 3 次握手
- 建立TCP连接后发起http请求
- 服务器响应http请求，浏览器得到html代码
- 浏览器解析html代码，并请求 html 代码中的资源（如js、css、图片等，此处可能涉及HTTP缓存）
- 浏览器对页面进行渲染呈现给用户（此处涉及浏览器的渲染原理）

## 浏览器加载顺序
1. 浏览器一边下载 HTML 网页，一边开始解析
2. 解析过程中，发现\<script>标签
3. 暂停解析，网页渲染的控制权转交给JavaScript引擎
4. 如果\<script>标签引用了外部脚本，就下载该脚本，否则就直接执行
5. 执行完毕，控制权交还渲染引擎，恢复往下解析HTML网页
> 将js放在body的最后面，可以避免资源阻塞，同时使静态的html页面迅速显示。
如果外部脚本加载时间很长（比如一直无法完成下载），就会造成网页长时间失去响应，浏览器就会呈现“假死”状态，这被称为“阻塞效应”。
html需要等head中所有的js和css加载完成后才会开始绘制，但是html不需要等待放在body最后的js下载执行就会开始绘制。

> 将css放在head里，可避免浏览器渲染的重复计算。
经过上面的渲染过程，我们知道Layout的计算是比较消耗性能的，所以我们在开始计算Render Tree之前，就把所有的css文件拿到，这样可减少Repaint和Reflow。